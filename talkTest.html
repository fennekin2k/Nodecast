<html><head><title>Purecast test page</title><style>
.record, .stop { width: 400px; height: 48px; font-size: 2em; margin-top: 160px; }
</style></head><body>

<button class='record'>RECORD</button>
<button class='stop'>STOP</button>

</body><script>
'use strict'

const recordBtn =document.querySelector('.record');
const stopBtn =document.querySelector('.stop');

if(navigator.mediaDevices &&navigator.mediaDevices.getUserMedia){
	
	navigator.mediaDevices.getUserMedia({ audio: true })
	.then(function(stream){
		const mediaRecorder =new MediaRecorder(stream);
		
		recordBtn.onclick =function(){
			mediaRecorder.start(1000); // 400 msec buffer flush interval
			console.log('recorder started ->', mediaRecorder.state);
		}
		
		mediaRecorder.ondataavailable =function(e){ // buffer flush
			
			let chunk =e.data;
			console.log(chunk);
			
			let oReq =new XMLHttpRequest();
			oReq.open('POST', 'http://178.154.211.249:8080/talk', true);
			oReq.onloadend =function(oEvent){};
			oReq.send(chunk);
			oReq.onerror =function(){
				console.log(this);
			};
		}
		
		stopBtn.onclick =function(){
			mediaRecorder.stop();
			console.log('recorder stopped ->', mediaRecorder.state);
		}
	})
	.catch(function(err){ console.log('getUserMedia error ->', err); });
}
else 
	console.log('getUserMedia not supported');
</script>
</html>